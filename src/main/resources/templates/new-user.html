<!DOCTYPE html>
<html>
    <head>
        <title>用户列表-添加新用户</title>

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

        <!-- bootstrap -->
        <link rel="stylesheet" type="text/css" href="../static/css/bootstrap/bootstrap.css"/>
        <link rel="stylesheet" type="text/css" href="../static/css/bootstrap/bootstrap-overrides.css"/>

        <!-- global styles -->
        <link rel="stylesheet" type="text/css" href="../static/css/compiled/layout.css"/>
        <link rel="stylesheet" type="text/css" href="../static/css/compiled/elements.css"/>
        <link rel="stylesheet" type="text/css" href="../static/css/compiled/icons.css"/>

        <!-- libraries -->
        <link rel="stylesheet" type="text/css" href="../static/css/lib/font-awesome.css"/>

        <!-- this page specific styles -->
        <link rel="stylesheet" type="text/css" media="screen" href="../static/css/compiled/new-user.css"/>

        <!-- open sans font -->
        <!--<link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,800italic,400,300,600,700,800'/>-->

        <!-- choose deep color skin in nav -->
        <link rel="stylesheet" type="text/css" id="skin-file" href="../static/css/compiled/skins/dark.css">

        <!--[if lt IE 9]-->
        <!--<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>-->

        <!-- scripts -->
        <script src="../static/js/jquery.min.js"></script>
        <script src="../static/js/bootstrap/bootstrap.min.js"></script>
        <script src="../static/js/jquery-ui-1.10.2.custom.min.js"></script>
    </head>
    <body>
        <!-- navbar -->
        <header class="navbar navbar-inverse" role="banner">
            <div class="navbar-header">
                <a class="navbar-brand" href="/admin-home"><h2>Ji Admin</h2></a>
            </div>
            <ul class="nav navbar-nav pull-right hidden-xs">
                <li class="dropdown">
                    <a id="a-username" href="#" class="dropdown-toggle hidden-xs hidden-sm" data-toggle="dropdown">
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="#">个人信息</a></li>
                        <li><a href="#">账号设置</a></li>
                    </ul>
                </li>
                <li class="settings hidden-xs hidden-sm">
                    <a href="#" role="button">
                        <i class="icon-cog"></i>
                    </a>
                </li>
                <li class="settings hidden-xs hidden-sm">
                    <a href="#" role="button">
                        <i class="icon-share-alt"></i>
                    </a>
                </li>
            </ul>
        </header>
        <!-- end navbar -->

        <!-- sidebar -->
        <div id="sidebar-nav">
            <ul id="dashboard-menu">
                <li>
                    <a href="/admin-home">
                        <i class="icon-home"></i>
                        <span>首页</span>
                    </a>
                </li>
                <li>
                    <a class="dropdown-toggle" href="#">
                        <i class="icon-windows"></i>
                        <span>系统</span>
                        <i class="icon-chevron-down"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/sys-user">系统用户列表</a></li>
                        <li><a href="/role">用户角色列表</a></li>
                        <li><a href="/advert">广告列表</a></li>
                    </ul>
                </li>
                <li class="active">
                    <div class="pointer">
                        <div class="arrow"></div>
                        <div class="arrow_border"></div>
                    </div>
                    <a class="dropdown-toggle" href="#">
                        <i class="icon-group"></i>
                        <span>用户</span>
                        <i class="icon-chevron-down"></i>
                    </a>
                    <ul class="active submenu">
                        <li><a href="/user" class="active">用户列表</a></li>
                    </ul>
                </li>
                <li>
                    <a class="dropdown-toggle" href="#">
                        <i class="icon-file"></i>
                        <span>文档</span>
                        <i class="icon-chevron-down"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/file">文档列表</a></li>
                        <li><a href="/folder">文件夹列表</a></li>
                    </ul>
                </li>
                <li>
                    <a class="dropdown-toggle" href="#">
                        <i class="icon-edit-sign"></i>
                        <span>账目</span>
                        <i class="icon-chevron-down"></i>
                    </a>
                    <ul class="submenu">
                        <li><a href="/account">账目列表</a></li>
                        <li><a href="/acc-type">账目类型列表</a></li>
                    </ul>
                </li>
            </ul>
        </div>
        <!-- end sidebar -->

        <!-- main container -->
        <div class="content">
            <div id="pad-wrapper" class="new-user">
                <div class="row head">
                    <div class="col-md-12">
                        <h4>添加新用户</h4>
                    </div>
                </div>

                <!-- start new user -->
                <div class="row form-wrapper">
                    <!-- left column -->
                    <div class="col-md-9 with-sidebar">
                        <div class="container">
                            <form id="add_form" class="new_user_form">
                                <div class="col-md-12 field-box">
                                    <label>用户名</label>
                                    <input id="inputNikeName" class="form-control" type="text" placeholder="输入用户名"/>
                                </div>
                                <div class="col-md-12 field-box">
                                    <label>性别</label>
                                    <div class="ui-select span5">
                                        <select id="genderSelect">
                                            <option value="1">男</option>
                                            <option value="0">女</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12 field-box">
                                    <label>国家</label>
                                    <input id="inputCountry" class="form-control" type="text" placeholder="请输入国家" />
                                </div>
                                <div class="col-md-12 field-box">
                                    <label>省份</label>
                                    <input id="inputProvince" class="form-control" type="text" placeholder="请输入省份" />
                                </div>
                                <div class="col-md-12 field-box">
                                    <label>城市</label>
                                    <input id="inputCity" class="form-control" type="text" placeholder="请输入城市" />
                                </div>
                                <div class="col-md-12 field-box">
                                    <label>语言</label>
                                    <input id="inputLanguage" class="form-control" type="text" placeholder="请输入语言" />
                                </div>
                                <div class="col-md-12 field-box">
                                    <label>头像</label>
                                    <img width="100" height="100" id="picUrl"/>
                                    <input id="inputAvatarUrl" class="form-control" type="file" onchange="uploadFile()" />
                                </div>
                                <div class="col-md-12 field-box">
                                    <label>备注</label>
                                    <input id="inputRemark" class="form-control" type="text" placeholder="输入备注" />
                                </div>
                                <div class="col-md-12 field-box">
                                    <label>状态</label>
                                    <div class="ui-select span5">
                                        <select id="statusSelect">
                                            <option value="y">启用</option>
                                            <option value="n">停用</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-11 field-box actions">
                                    <button id="save_btn" type="button" class="btn primary">
                                        <span class="glyphicon glyphicon-save" aria-hidden="true"></span>保存
                                    </button>
                                    <span>OR</span>
                                    <input type="reset" value="重置" class="reset">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- end new user -->
            </div>
        </div>

        <script src="../static/js/theme.js"></script>
        <!-- knob -->
        <script src="../static/js/jquery.knob.js"></script>
        <!-- import common-utils js-->
        <script src="../static/js/common-utils.js"></script>
        <script src="../static/js/ji-validate.js"></script>
        <script type="text/javascript">
            //显示当前系统用户名
            var str = sessionStorage.getItem("sys-user");
            var user = JSON.parse(str);
            $("#a-username").text("hello!   " + user.result.username);

            //保存新用户角色
            $("#save_btn").click(function(){
                $.ajax({
                    type: "POST",
                    url: "/user/save",
                    data: JSON.stringify ({
                        "nickName": $("#inputNikeName").val(),
                        "gender": $("#genderSelect").find("option:selected").val(),
                        "country": $("#inputCountry").val(),
                        "province": $("#inputProvince").val(),
                        "city": $("#inputCity").val(),
                        "language": $("#inputLanguage").val(),
                        "avatarUrl": document.getElementById("picUrl").getAttribute("src"),
                        "remark": $("#inputRemark").val(),
                        "createAccount": user.result.username,
                        "createTime": new Date(),
                        "status": $("#statusSelect").find("option:selected").val()
                    }),
                    contentType: "application/json;charset=UTF-8",
                    dataType: 'json',
                    success: function(data){
                        if (data.code == 200) {
                            alert("保存成功！");
                            window.location.href = "/user";
                        } else {
                            alert("保存失败！");
                        }
                    }
                });
            });

            // 上传头像
            var uploadFile = function uploadPic() {
                var formData = new FormData();
                formData.append("file", $("#add_form").find('input[type="file"]')[0].files[0]);
                $.ajax({
                    type: "POST",
                    url: "/upload/uploadPic",
                    data: formData,
                    dataType: 'json',
                    async: false,
                    cache: false,
                    contentType: false,
                    processData: false,
                    // 请求成功时执行的回调函数
                    success: function(data, status, xhr) {
                        // 图片显示地址
                        $("#picUrl").attr("src", data.picPath);
                    }
                });
            };
        </script>

    </body>
</html>